<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myapp.sscmybatis_02._01_mapper.NoticeMapper">

    <select id="getNoticeList" resultType="com.myapp.sscmybatis_02._03_vo.NoticeVO">
        SELECT
            n.noticeNo,
            n.content AS notice_content,
            n.startDate AS notice_startDate,
            n.endDate AS notice_endDate,
            n.uploadDate AS notice_uploadDate,
            n.title AS notice_title,
            u.userNo AS user_userNo,
            u.name AS user_name
        FROM
            notice n
                LEFT JOIN
            user u ON n.userNo = u.userNo;
    </select>

    <select id="getNoticeById" resultType="com.myapp.sscmybatis_02._03_vo.NoticeVO">
        SELECT
            n.noticeNo,
            n.content AS notice_content,
            n.startDate AS notice_startDate,
            n.endDate AS notice_endDate,
            n.uploadDate AS notice_uploadDate,
            n.title AS notice_title,
            u.userNo AS user_userNo,
            u.name AS user_name
        FROM
            notice n
                LEFT JOIN
            user u ON n.userNo = u.userNo
        WHERE
            n.noticeNo = #{noticeNo};
    </select>

    <insert id="insertNotice">
        INSERT INTO notice (content, startDate, endDate, uploadDate, title, userNo)
        VALUES (#{content}, #{startDate}, #{endDate}, NOW(), #{title}, #{userNo});
    </insert>

    <select id="searchNotices" resultType="com.myapp.sscmybatis_02._03_vo.NoticeVO">
        SELECT
            n.noticeNo,
            n.content AS notice_content,
            n.startDate AS notice_startDate,
            n.endDate AS notice_endDate,
            n.uploadDate AS notice_uploadDate,
            n.title AS notice_title,
            u.userNo AS user_userNo,
            u.name AS user_name
        FROM
            notice n
                LEFT JOIN
            user u ON n.userNo = u.userNo
        WHERE
            n.title LIKE CONCAT('%', #{keyword}, '%')
           OR n.content LIKE CONCAT('%', #{keyword}, '%');
    </select>

    <update id="updateNotice">
        UPDATE notice
        SET content = #{content}, startDate = #{startDate}, endDate = #{endDate}, title = #{title}, uploadDate = NOW()
        WHERE noticeNo = #{noticeNo};
    </update>
</mapper>